<!DOCTYPE html>
<html>
<head>
    <title>Firebase Setup</title>
</head>
<body>
    <h2>Firebase Setup</h2>
    <div id="status"></div>

    <h3>1. Create Users</h3>
    <button onclick="createUsers()">Create Test Users</button>

    <h3>2. Initialize Collections</h3>
    <button onclick="initializeCollections()">Initialize Collections</button>

    <h3>3. Add Test Vehicles</h3>
    <button onclick="addTestVehicles()">Add Test Vehicles</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { FIREBASE_CONFIG } from './src/api/config.js';

        // Initialize Firebase
        const app = initializeApp(FIREBASE_CONFIG);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Create test users
        window.createUsers = async () => {
            try {
                // Create dispatcher
                await createUserWithEmailAndPassword(auth, "dispatcher@example.com", "password123");
                await createUserWithEmailAndPassword(auth, "priya@example.com", "password123");
                document.getElementById('status').innerHTML = "Users created successfully!";
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    document.getElementById('status').innerHTML = "Users already exist - that's okay!";
                } else {
                    document.getElementById('status').innerHTML = "Error: " + error.message;
                }
            }
        };

        // Initialize collections
        window.initializeCollections = async () => {
            try {
                // Create empty documents to initialize collections
                await setDoc(doc(db, "vehicles", "_init"), { initialized: true });
                await setDoc(doc(db, "tasks", "_init"), { initialized: true });
                await setDoc(doc(db, "driver_routes", "_init"), { initialized: true });
                document.getElementById('status').innerHTML = "Collections initialized!";
            } catch (error) {
                document.getElementById('status').innerHTML = "Error initializing collections: " + error.message;
            }
        };

        // Add test vehicles
        window.addTestVehicles = async () => {
            try {
                // Add VAN-01
                await setDoc(doc(db, "vehicles", "VAN-01"), {
                    driverName: "Priya Sharma",
                    driverEmail: "priya@example.com",
                    maxCapacity: 100,
                    startLocation: { latitude: 19.2183, longitude: 72.9781 },
                    liveLocation: { latitude: 19.2183, longitude: 72.9781 },
                    liveStatus: "idle",
                    shiftStart: new Date("2025-09-29T09:00:00"),
                    shiftEnd: new Date("2025-09-29T17:00:00")
                });

                // Add VAN-02
                await setDoc(doc(db, "vehicles", "VAN-02"), {
                    driverName: "Amit Kumar",
                    driverEmail: "amit@example.com",
                    maxCapacity: 80,
                    startLocation: { latitude: 19.2183, longitude: 72.9781 },
                    liveLocation: { latitude: 19.2183, longitude: 72.9781 },
                    liveStatus: "idle",
                    shiftStart: new Date("2025-09-29T09:00:00"),
                    shiftEnd: new Date("2025-09-29T17:00:00")
                });

                document.getElementById('status').innerHTML = "Test vehicles added successfully!";
            } catch (error) {
                document.getElementById('status').innerHTML = "Error adding vehicles: " + error.message;
            }
        };
    </script>
</body>
</html>
